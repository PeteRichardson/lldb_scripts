#!/Library/Developer/CommandLineTools/usr/bin/python3
# NOTE:  must use the python3 in the CommandLineTools directory, not the Homebrew python3
#        because the Homebrew python3 does not have the lldb module

# make lldb module available
import sys
sys.path.append('/Library/Developer/CommandLineTools/Library/PrivateFrameworks/LLDB.framework/Versions/A/Resources/Python')
import lldb
import os

if len(sys.argv) < 2:
    print("Usage:  sections <executable>")
    sys.exit(1)

exe = sys.argv[1]

if os.path.exists(exe) == False:
    print(f"# File '{exe}' does not exist.", file=sys.stderr)
    sys.exit(1)

# Create a new debugger instance and a target
debugger = lldb.SBDebugger.Create()
target = debugger.CreateTarget (exe, None, None, False, lldb.SBError())

if target:
    for module in target.module_iter():
        for sec in module.section_iter():
            print(sec)
            for subsec in sec:
                print(f"    {repr(subsec)}")
else:
    print("# Failed to create target.  Check the filetype.", file=sys.stderr)       